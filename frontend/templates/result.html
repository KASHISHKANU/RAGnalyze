<!DOCTYPE html>
<html>
<head>
    <title>RAGnalyze ‚Äì Results</title>

    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .model-card {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0,0,0,0.08);
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            color: white;
            margin-right: 6px;
        }

        .badge.fast { background: #28a745; }
        .badge.best { background: #6f42c1; }
        .badge.warn { background: #dc3545; }
        .badge.free { background: #17a2b8; }

        .answer-box {
            background: #ffffff;
            padding: 12px;
            margin-top: 10px;
            border-radius: 6px;
            white-space: pre-wrap;
        }

        canvas {
            margin: 30px 0;
        }
    </style>
</head>

<body>

<div class="container">
    <h1>üìä RAG Analysis Result</h1>

    <p><b>URL:</b> {{ url }}</p>
    <p><b>Question:</b> {{ question }}</p>

    <hr>

    <h2>üìà Model Comparison</h2>

    <canvas id="latencyChart"></canvas>
    <canvas id="faithfulnessChart"></canvas>
    <canvas id="hallucinationChart"></canvas>

    <hr>

    <h2>üß† Model Outputs</h2>

    {% for result in results %}
        <div class="model-card">
            <h3>{{ result.model }}</h3>

            {% if result.model == fastest %}
                <span class="badge fast">Fastest ‚ö°</span>
            {% endif %}

            {% if result.model == best_reasoning %}
                <span class="badge best">Best Grounded üß†</span>
            {% endif %}

            {% if result.hallucination_pct > 30 %}
                <span class="badge warn">High Hallucination ‚ö†Ô∏è</span>
            {% endif %}

            {% if result.cost.cost_usd == 0 %}
                <span class="badge free">FREE MODEL üí∏</span>
            {% endif %}

            <p><b>Latency:</b> {{ result.latency }} sec</p>

            <p><b>Faithfulness (Heuristic):</b> {{ result.metrics.faithfulness }}</p>
            <p><b>RAGAS Faithfulness:</b> {{ result.ragas.ragas_faithfulness }}</p>

            <p><b>Compression:</b> {{ result.metrics.compression }}</p>
            <p><b>Hallucination %:</b> {{ result.hallucination_pct }}</p>

            <p>
                <b>Tokens:</b>
                {{ result.cost.input_tokens }} in /
                {{ result.cost.output_tokens }} out
                ({{ result.cost.total_tokens }} total)
            </p>

            <p><b>Estimated Cost:</b> ${{ result.cost.cost_usd }}</p>

            <div class="answer-box">
                {{ result.answer }}
            </div>
        </div>
    {% endfor %}

    <a href="/">‚Üê Analyze another video</a>
</div>

<script>
    const chartData = {{ chart_data | tojson }};

    new Chart(document.getElementById("latencyChart"), {
        type: "bar",
        data: {
            labels: chartData.labels,
            datasets: [{
                label: "Latency (seconds)",
                data: chartData.latency,
                backgroundColor: "#007bff"
            }]
        }
    });

    new Chart(document.getElementById("faithfulnessChart"), {
        type: "bar",
        data: {
            labels: chartData.labels,
            datasets: [{
                label: "Faithfulness Score",
                data: chartData.faithfulness,
                backgroundColor: "#6f42c1"
            }]
        }
    });

    new Chart(document.getElementById("hallucinationChart"), {
        type: "bar",
        data: {
            labels: chartData.labels,
            datasets: [{
                label: "Hallucination %",
                data: chartData.hallucination,
                backgroundColor: "#dc3545"
            }]
        }
    });
</script>

</body>
</html>
